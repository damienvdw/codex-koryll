<%
  var title = '';
  if (page.category) title = page.category;
  if (page.tag) title = page.tag;
  if (page.archive){
      if (page.year) title = page.year + (page.month ? '/' + page.month : '');
      else title = "Archives";
  }

  var other_cats = {};
  var only_current_cat = function(post,index){
    var is_valid = false;
    if (page.category) {
      if(post.categories.last().name === page.category ){
        is_valid = true;
      }
      else{
        other_cats[post.categories.last().name] = post.categories.last();
      }
    }
    else{
      is_valid = true;
    }
    return is_valid;
  };
  var the_filtered_posts = page.posts.sort('title').filter(only_current_cat);

%>

<!-- Main Content -->
<div class="col-sm-8 blog-main">

  <% if(title) { %>
     <h2 class="blog-archive-title"><%- title %></h2>
  <% } %>

  <% Object.keys(other_cats).map(function(catKey, index) { %>
    <h2 class="blog-post-title-archive">
      <a href="<%- config.root + other_cats[catKey].path %>">
        <span class="glyphicon glyphicon-folder-open"></span>  <%- other_cats[catKey].name %>
      </a>
    </h2><p class="blog-post-meta"></p>
  <% }); %>

  <% the_filtered_posts.each(function(item){ %>
      <%- partial('_partial/article-archive', {item: item}) %>
  <% }); %>

</div>
<!-- Sidebar -->
<div class="col-sm-3 col-sm-offset-1 blog-sidebar">
  <%- partial('_partial/my_cat_list', {item: page}) %>
</div>
